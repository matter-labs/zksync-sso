[package]
name = "zksync-sso-erc4337-web-ffi"
version.workspace = true
edition.workspace = true
rust-version.workspace = true
license.workspace = true
repository.workspace = true
description = "WebAssembly FFI bindings for zkSync SSO ERC-4337"

[package.metadata.wasm-pack.profile.release]
wasm-opt = false

[lib]
crate-type = ["cdylib"]

[dependencies]
# Core dependency - exclude tokio-runtime for WASM compatibility
zksync-sso-erc4337-core = { path = "../zksync-sso-erc4337-core", default-features = false }

# Alloy for primitives (keccak256, hex encoding)
alloy.workspace = true
alloy-provider.workspace = true
alloy-transport = "1.0"
alloy-transport-http = "1.0"
alloy-json-rpc = "1.0"
alloy-rpc-client = "1.0"

# WASM HTTP client
reqwasm = "0.5"

# Uniffi for FFI bindings
uniffi.workspace = true

# Error handling
thiserror.workspace = true
eyre.workspace = true

# Logging/Tracing
tracing.workspace = true

# Async - Use only wasm-bindgen-futures for WASM compatibility
async-trait.workspace = true
futures.workspace = true

# Web-specific dependencies
wasm-bindgen.workspace = true
wasm-bindgen-futures.workspace = true
js-sys.workspace = true
web-sys.workspace = true
console_error_panic_hook.workspace = true
console_log.workspace = true
log.workspace = true

# Additional dependencies for WASM
hex = "0.4"
getrandom = { version = "0.2", features = ["js"] }

# Serialization (optional, for future use)
serde = { workspace = true, optional = false }
serde_json = { workspace = true, optional = false }

# Tower for Service trait
tower = "0.5"
tracing-subscriber.workspace = true
tracing-web = "0.1.3"

# Explicitly add getrandom v0.2 with js feature for WASM (used by rand 0.8 from alloy)
[target.'cfg(target_arch = "wasm32")'.dependencies]
getrandom = { version = "0.2", features = ["js"] }

[features]
default = []

[dev-dependencies]
tokio = { workspace = true, features = ["full"] }
eyre = { workspace = true }
zksync-sso-erc4337-core = { path = "../zksync-sso-erc4337-core", features = ["tokio-runtime", "test-utilities"] }
alloy = { workspace = true, features = ["node-bindings"] }
