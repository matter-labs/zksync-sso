<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0"
    />
    <title>PayPal Wallet - Powered by ZKsync</title>
    <link
      rel="icon"
      type="image/svg+xml"
      href="/favicon.svg"
    />
    <link
      rel="stylesheet"
      href="styles.css"
    />
  </head>
  <body>
    <!-- PayPal Header -->
    <div class="paypal-header">
      <div class="nav-left">
        <div class="paypal-logo">PayPal</div>
        <label class="lang-label">
          <select id="lang">
            <option value="en">English</option>
            <option value="es">Español</option>
            <option value="pt">Português (BR)</option>
          </select>
        </label>
      </div>
      <div class="header-right">
        <div class="header-network">
          <span id="topbar-network"></span>: <strong><span id="headerNetwork">--</span></strong>
        </div>
        <div class="header-balance">
          <span id="topbar-balance"></span>: <strong><span id="headerBalance">--</span> ETH</strong>
        </div>
      </div>
    </div>

    <div class="container">
      <!-- Navigation Tabs -->
      <div class="nav-tabs">
        <button
          class="nav-tab active"
          data-tab="home"
          id="nav-home"
        ></button>
        <button
          class="nav-tab"
          data-tab="send"
          id="nav-send"
        ></button>
        <button
          class="nav-tab"
          data-tab="earn"
          id="nav-earn"
        ></button>
        <button
          class="nav-tab"
          data-tab="interop"
          id="nav-interop"
        ></button>
        <button
          class="nav-tab"
          data-tab="activity"
          id="nav-activity"
        ></button>
      </div>

      <!-- Home Tab -->
      <div
        class="tab-content active"
        id="home-tab"
      >
        <!-- Setup Steps (shown if not fully set up) -->
        <div id="setup-section">
          <div class="card">
            <div
              id="home-get-started"
              class="card-title"
            ></div>
            <div
              id="home-setup-wallet"
              class="card-subtitle"
            >
              Set up your secure PayPal wallet to start sending and receiving money
            </div>
          </div>

          <!-- Step 1: Create Passkey -->
          <div
            class="setup-step"
            id="passkey-step"
          >
            <div class="step-header">
              <div
                class="step-icon"
                id="passkey-icon"
              >
                1
              </div>
              <div
                id="home-create-key"
                class="step-title"
              ></div>
            </div>

            <div id="passkey-input">
              <div class="form-group">
                <label
                  id="home-user-name"
                  for="userName"
                ></label>
                <input
                  type="text"
                  id="userName"
                  placeholder="Enter your name"
                />
              </div>
              <button id="createPasskeyBtn"></button>
            </div>

            <div
              id="passkey-success"
              class="hidden alert alert-success"
            >
              <strong id="home-key-created"></strong>
              <div class="info-row">
                <span
                  id="home-credential-id"
                  class="info-label"
                ></span>
                <span class="info-value"><code id="credentialIdDisplay"></code></span>
              </div>
              <button
                id="resetPasskeyBtn"
                class="secondary small"
              ></button>
            </div>

            <div
              id="passkey-error"
              class="hidden alert alert-error"
            ></div>
          </div>

          <!-- Step 2: Deploy Account -->
          <div
            class="setup-step"
            id="deploy-step"
          >
            <div class="step-header">
              <div
                class="step-icon"
                id="deploy-icon"
              >
                2
              </div>
              <div
                id="home-activate-wallet"
                class="step-title"
              ></div>
            </div>

            <div id="deploy-button-container">
              <p
                id="home-deploy-wallet"
                class="card-subtitle"
              ></p>
              <button
                id="deployAccountBtn"
                disabled
              ></button>
            </div>

            <div
              id="deploy-success"
              class="hidden alert alert-success"
            >
              <strong id="home-wallet-activated"></strong>
              <div class="info-row">
                <span
                  id="home-wallet-address"
                  class="info-label"
                ></span>
                <span class="info-value"><code id="accountAddressDisplay"></code></span>
              </div>
              <button
                id="refreshBalanceBtn"
                class="secondary small"
              ></button>
            </div>

            <div
              id="deploy-error"
              class="hidden alert alert-error"
            ></div>
          </div>
        </div>

        <!-- Main Wallet View (shown after setup) -->
        <div
          id="wallet-view"
          class="hidden"
        >
          <div class="balance-display">
            <div
              id="home-wallet-balance"
              class="balance-label"
            ></div>
            <div class="balance-amount"><span id="balanceDisplay">0.00</span> ETH</div>
          </div>

          <div class="card">
            <div
              id="home-your-wallet"
              class="card-title"
            ></div>
            <div class="info-row">
              <span
                id="home-wallet-address-2"
                class="info-label"
              ></span>
              <span class="info-value"><code id="walletAddressDisplay"></code></span>
            </div>
            <button
              id="resetPasskeyMainBtn"
              class="secondary small"
              style="margin-top: 12px"
            ></button>
          </div>

          <div class="card">
            <div
              id="home-quick-actions"
              class="card-title"
            ></div>
            <button id="quickSendBtn"></button>
            <button
              id="quickEarnBtn"
              class="secondary"
              style="margin-top: 12px"
            ></button>
            <button
              id="faucetBtn"
              class="secondary"
              style="margin-top: 12px"
            ></button>
          </div>
        </div>
      </div>

      <!-- Send Tab -->
      <div
        class="tab-content"
        id="send-tab"
      >
        <div class="card">
          <div
            id="send-money"
            class="card-title"
          ></div>

          <div id="transfer-form">
            <div class="form-group">
              <label
                id="send-recipient"
                for="recipientAddress"
              ></label>
              <input
                type="text"
                id="recipientAddress"
                placeholder="0x..."
              />
            </div>

            <div class="form-group">
              <label
                id="send-amount"
                for="transferAmount"
              ></label>
              <div style="display: flex; gap: 8px; align-items: center">
                <input
                  type="number"
                  id="transferAmount"
                  step="0.001"
                  placeholder="0.01"
                  style="flex: 4"
                />
                <button
                  id="sendMaxBtn"
                  type="button"
                  style="flex: 1; padding: 8px; white-space: nowrap; font-size: 13px"
                  disabled
                >
                  Max
                </button>
              </div>
              <div
                id="max-amount-info"
                style="font-size: 12px; color: #6c7378; margin-top: 4px"
              ></div>
            </div>

            <button
              id="transferBtn"
              disabled
            ></button>
          </div>

          <div
            id="transfer-success"
            class="hidden alert alert-success"
          >
            <strong id="send-tx-sent"></strong>
            <div class="info-row">
              <span
                id="send-tx-label"
                class="info-label"
              ></span>
              <span class="info-value">
                <a
                  id="transfer-tx-link"
                  href="#"
                  target="_blank"
                  style="color: #0070ba; text-decoration: underline"
                >
                  <code id="txHashDisplay"></code>
                </a>
              </span>
            </div>
          </div>

          <div
            id="transfer-error"
            class="hidden alert alert-error"
          ></div>
        </div>
      </div>

      <!-- Earn Tab -->
      <div
        class="tab-content"
        id="earn-tab"
      >
        <div class="card">
          <div
            id="earn-title"
            class="card-title"
          ></div>
          <div
            id="earn-subtitle"
            class="card-subtitle"
          ></div>
        </div>

        <div
          id="aave-balance-section"
          class="card hidden"
        >
          <div class="info-row">
            <span
              id="earn-shadow"
              class="info-label"
            ></span>
            <span class="info-value"><code id="shadowAccountDisplay"></code></span>
          </div>
          <div class="info-row">
            <span
              id="earn-deposits"
              class="info-label"
              >:</span
            >
            <span class="info-value"><span id="aaveBalanceDisplay">0</span> aETH</span>
          </div>
          <button
            id="refreshAaveBalanceBtn"
            class="secondary small"
          ></button>
        </div>

        <div class="card">
          <div
            id="earn-deposit-label"
            class="card-title"
          ></div>
          <div id="aave-deposit-form">
            <div class="form-group">
              <label
                id="earn-deposit-amount"
                for="aaveDepositAmount"
              ></label>
              <input
                type="number"
                id="aaveDepositAmount"
                step="0.01"
                placeholder="0.1"
              />
            </div>
            <button
              id="aaveDepositBtn"
              disabled
            ></button>
          </div>

          <div
            id="aave-deposit-success"
            class="hidden alert alert-success"
          >
            <strong id="earn-deposit-init"></strong>
            <div class="info-row">
              <span
                id="earn-deposit-tx"
                class="info-label"
              ></span>
              <span class="info-value"><code id="aaveDepositTxHash"></code></span>
            </div>
            <div
              id="earn-deposit-wait-msg"
              class="alert-info"
              style="margin-top: 12px; padding: 12px"
            ></div>
          </div>

          <div
            id="aave-deposit-error"
            class="hidden alert alert-error"
          ></div>
        </div>

        <div class="card">
          <div
            id="earn-withdraw-label"
            class="card-title"
          ></div>
          <div id="aave-withdraw-form">
            <div class="form-group">
              <label
                id="earn-withdraw-amount"
                for="aaveWithdrawAmount"
              ></label>
              <input
                type="number"
                id="aaveWithdrawAmount"
                step="0.01"
                placeholder="0.1"
              />
            </div>
            <button
              id="aaveWithdrawBtn"
              disabled
            ></button>
          </div>

          <div
            id="aave-withdraw-success"
            class="hidden alert alert-success"
          >
            <strong id="earn-withdraw-init"></strong>
            <div class="info-row">
              <span
                id="earn-withdraw-tx"
                e
                class="info-label"
              ></span>
              <span class="info-value"><code id="aaveWithdrawTxHash"></code></span>
            </div>
            <div
              id="earn-withdraw-wait-msg"
              class="alert-info"
              style="margin-top: 12px; padding: 12px"
            ></div>
          </div>

          <div
            id="aave-withdraw-error"
            class="hidden alert alert-error"
          ></div>
        </div>
      </div>

      <!-- Interop Tab -->
      <div
        class="tab-content"
        id="interop-tab"
      >
        <div class="card">
          <div
            id="interop-title"
            class="card-title"
          ></div>
          <div class="card-subtitle">
            <span id="interop-subtitle"></span>
            <br /><strong><span id="interop-note-label"></span></strong> <span id="interop-note"></span>
          </div>
        </div>

        <div class="card">
          <div class="alert-info">
            <strong id="interop-setup-warning"></strong>
            <span id="interop-setup-msg"></span>
            <ul style="margin: 8px 0 0 20px">
              <li><span id="interop-chain-a"></span> http://localhost:3050</li>
              <li><span id="interop-chain-b"></span> http://localhost:3051</li>
            </ul>
          </div>
        </div>

        <!-- Connection Warning -->
        <div
          id="interop-connection-warning"
          class="card hidden"
        >
          <div class="alert alert-error">
            <strong>⚠️ <span id="interop-connection-issue"></span></strong>
            <div id="interop-warning-message"></div>
            <div style="margin-top: 8px; font-size: 14px">
              <span id="interop-connection-msg"></span>
              <ul style="margin: 4px 0 0 20px">
                <li id="interop-connection-check-1"></li>
                <li id="interop-connection-check-2"></li>
              </ul>
            </div>
          </div>
        </div>

        <div class="card">
          <div
            id="interop-send-msg-label"
            class="card-title"
          ></div>
          <div id="interop-form">
            <div class="form-group">
              <label
                id="interop-msg-label"
                for="interopMessage"
              ></label>
              <input
                type="text"
                id="interopMessage"
                placeholder="hello interop"
                value="hello interop"
              />
            </div>

            <div class="form-group">
              <label
                id="interop-msg-direction"
                for="interopMessageDirection"
              ></label>
              <select
                id="interopMessageDirection"
                style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px"
              >
                <option
                  id="interop-a-to-b"
                  value="a-to-b"
                ></option>
                <option
                  id="interop-b-to-a"
                  value="b-to-a"
                ></option>
              </select>
            </div>

            <button id="interopSendBtn"></button>
          </div>

          <div
            id="interop-progress"
            class="hidden alert alert-info"
          >
            <strong id="interopProgressTitle"></strong>
            <div id="interopProgressSteps"></div>
          </div>

          <div
            id="interop-success"
            class="hidden alert alert-success"
          >
            <strong id="interop-msg-verified"></strong>
            <div class="info-row">
              <span
                id="interop-src-chain-tx"
                class="info-label"
              ></span>
              <span class="info-value"><code id="interopTxHashSource"></code></span>
            </div>
            <div class="info-row">
              <span
                id="interop-l1-batch"
                class="info-label"
              ></span>
              <span class="info-value"><code id="interopBatchNumber"></code></span>
            </div>
            <div class="info-row">
              <span
                id="interop-msg-index"
                class="info-label"
              ></span>
              <span class="info-value"><code id="interopMessageIndex"></code></span>
            </div>
            <div class="info-row">
              <span
                id="interop-msg-final-direction"
                class="info-label"
              ></span>
              <span class="info-value"><span id="interopMessageDirectionValue"></span></span>
            </div>
            <div class="info-row">
              <span
                id="interop-msg-verified-on-dest"
                class="info-label"
              ></span>
              <span
                id="interop-msg-success"
                class="info-value"
                style="color: #4caf50"
              ></span>
            </div>
          </div>

          <div
            id="interop-error"
            class="hidden alert alert-error"
          ></div>
        </div>

        <!-- Token Transfer Section -->
        <div class="card">
          <div
            id="interop-token-transfer-title"
            class="card-title"
          ></div>
          <div
            id="interop-token-transfer-subtitle"
            class="card-subtitle"
          ></div>

          <!-- Token Info -->
          <div
            id="token-info"
            class="alert-info"
          >
            <div class="info-row">
              <span
                id="interop-token-label"
                class="info-label"
              ></span>
              <span class="info-value"><span id="tokenSymbol">-</span> (<span id="tokenName">-</span>)</span>
            </div>
            <div class="info-row">
              <span
                id="interop-token-address"
                class="info-label"
              ></span>
              <span class="info-value"><code id="tokenAddress">Loading...</code></span>
            </div>
            <div class="info-row">
              <span
                id="interop-chain-a-balance"
                class="info-label"
              ></span>
              <span class="info-value"><span id="tokenBalanceA">-</span> <span id="tokenSymbolA"></span></span>
            </div>
            <div class="info-row">
              <span
                id="interop-chain-b-balance"
                class="info-label"
              ></span>
              <span class="info-value"><span id="tokenBalanceB">-</span> <span id="tokenSymbolB"></span></span>
            </div>
            <button
              id="refreshTokenBalancesBtn"
              style="margin-top: 12px"
            ></button>
          </div>

          <!-- Transfer Form -->
          <div id="token-transfer-form">
            <div class="form-group">
              <label
                id="interop-token-transfer-amount"
                for="tokenTransferAmount"
              ></label>
              <input
                type="number"
                id="tokenTransferAmount"
                placeholder="100"
                value="100"
                step="0.01"
                min="0"
              />
            </div>

            <div class="form-group">
              <label
                id="interop-transfer-direction"
                for="tokenTransferDirection"
              ></label>
              <select
                id="tokenTransferDirection"
                style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px"
              >
                <option
                  id="interop-transfer-token-a-to-b"
                  value="a-to-b"
                ></option>
                <option
                  id="interop-transfer-token-b-to-a"
                  value="b-to-a"
                ></option>
              </select>
            </div>

            <button id="tokenTransferBtn"></button>
          </div>

          <div
            id="token-transfer-progress"
            class="hidden alert alert-info"
          >
            <strong id="tokenTransferProgressTitle"></strong>
            <div id="tokenTransferProgressSteps"></div>
          </div>

          <div
            id="token-transfer-success"
            class="hidden alert alert-success"
          >
            <strong id="interop-transfer-complete"></strong>
            <div class="info-row">
              <span
                id="interop-status-src-chain-tx"
                class="info-label"
              ></span>
              <span class="info-value"><code id="tokenTransferTxHashSource"></code></span>
            </div>
            <div class="info-row">
              <span
                id="interop-destination-chain-tx"
                class="info-label"
              ></span>
              <span class="info-value"><code id="tokenTransferTxHashDest"></code></span>
            </div>
            <div class="info-row">
              <span
                id="interop-status-amount"
                class="info-label"
              ></span>
              <span class="info-value"
                ><span id="tokenTransferAmountValue"></span> <span id="tokenTransferSymbol"></span
              ></span>
            </div>
            <div class="info-row">
              <span
                id="interop-status-direction"
                class="info-label"
              ></span>
              <span class="info-value"><span id="tokenTransferDirectionValue"></span></span>
            </div>
          </div>

          <div
            id="token-transfer-error"
            class="hidden alert alert-error"
          ></div>
        </div>
      </div>

      <!-- Activity Tab -->
      <div
        class="tab-content"
        id="activity-tab"
      >
        <div class="card">
          <div
            id="activity-title"
            class="card-title"
          ></div>
          <div
            id="activity-subtitle"
            class="card-subtitle"
          ></div>
          <div
            id="activity-empty"
            style="text-align: center; padding: 40px; color: #6c7378"
          >
            <p id="activity-no-txns"></p>
          </div>
          <div
            id="activity-list"
            class="hidden"
          ></div>
        </div>
      </div>

      <!-- Footer -->
      <div class="footer">
        <strong><span id="footer-network"></span></strong> ZKSync OS Testnet (Layer 2) • Ethereum Sepolia (Layer 1)<br />
        <span id="footer-powered-by-zk"></span> • <span id="footer-secured-by-passkeys"></span>
      </div>
    </div>

    <script
      type="module"
      src="/translation.js"
    ></script>
    <script
      type="module"
      src="/main.js"
    ></script>
    <script>
      // Tab Navigation
      document.querySelectorAll(".nav-tab").forEach((tab) => {
        tab.addEventListener("click", () => {
          const tabName = tab.dataset.tab;

          // Update active tab
          document.querySelectorAll(".nav-tab").forEach((t) => t.classList.remove("active"));
          tab.classList.add("active");

          // Update active content
          document.querySelectorAll(".tab-content").forEach((content) => content.classList.remove("active"));
          document.getElementById(`${tabName}-tab`).classList.add("active");

          // Auto-load token balances when switching to interop tab
          if (tabName === "interop") {
            // Trigger refresh if handler is defined
            if (window.handleRefreshTokenBalances) {
              window.handleRefreshTokenBalances();
            }
          }
        });
      });

      // Quick action buttons
      document.getElementById("quickSendBtn")?.addEventListener("click", () => {
        document.querySelector('[data-tab="send"]').click();
      });

      document.getElementById("quickEarnBtn")?.addEventListener("click", () => {
        document.querySelector('[data-tab="earn"]').click();
      });

      // Update header balance when main balance changes
      const observer = new MutationObserver(() => {
        const mainBalance = document.getElementById("balanceDisplay").textContent;
        document.getElementById("headerBalance").textContent = mainBalance;
      });

      const balanceElement = document.getElementById("balanceDisplay");
      if (balanceElement) {
        observer.observe(balanceElement, { childList: true, characterData: true, subtree: true });
      }
    </script>
  </body>
</html>
