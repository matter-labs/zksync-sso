{
  "name": "demo-app",
  "tags": ["type:app"],
  "targets": {
    "dev:erc4337": {
      "executor": "nx:run-commands",
      "options": {
        "cwd": "examples/demo-app",
        "commands": [
          {
            "command": "pnpm nx dev auth-server",
            "prefix": "Auth-Server:"
          },

          {
            "command": "PORT=3004 nuxt dev",
            "prefix": "Demo-App:"
          }
        ]
      },
      "dependsOn": ["deploy-contracts-erc4337"]
    },
    "build:erc4337": {
      "executor": "nx:run-commands",
      "options": {
        "cwd": "examples/demo-app",
        "commands": [
          {
            "command": "pnpm nuxt generate"
          }
        ]
      },
      "dependsOn": ["deploy-contracts-erc4337"]
    },
    "build-contracts": {
      "executor": "nx:run-commands",
      "options": {
        "cwd": "examples/demo-app",
        "command": "FOUNDRY_LOG=trace forge build smart-contracts/ --root . --zksync"
      }
    },
    "build-erc4337-contracts": {
      "executor": "nx:run-commands",
      "options": {
        "cwd": "packages/erc4337-contracts",
        "command": "forge build"
      }
    },
    "deploy-contracts-erc4337": {
      "executor": "nx:run-commands",
      "options": {
        "cwd": "examples/demo-app",
        "command": "echo '{\"deployedTo\":\"0x0000000000000000000000000000000000000000\"}' > forge-output-paymaster.json && echo '{\"deployedTo\":\"0x0000000000000000000000000000000000000000\"}' > forge-output-erc1271.json && echo 'Created stub contract JSONs for ERC-4337 build'"
      },
      "dependsOn": ["deploy-msa-factory"]
    },
    "deploy-msa-factory": {
      "executor": "nx:run-commands",
      "options": {
        "cwd": "examples/demo-app",
        "command": "./scripts/deploy-msa-anvil.sh"
      },
      "dependsOn": ["build-erc4337-contracts"]
    },
    "build:local": {
      "executor": "nx:run-commands",
      "options": {
        "cwd": "examples/demo-app",
        "command": "pnpm nuxt generate --envName local"
      },
      "dependsOn": ["^build", "deploy-contracts-erc4337"]
    },
    "preview": {
      "executor": "nx:run-commands",
      "options": {
        "cwd": "examples/demo-app",
        "commands": [
          {
            "command": "pnpm nx preview auth-server",
            "prefix": "Auth-Server:"
          },
          {
            "command": "PORT=3004 pnpm nuxt preview",
            "prefix": "Demo-App:"
          }
        ]
      },
      "dependsOn": ["build:local"]
    },
    "e2e:setup:erc4337": {
      "executor": "nx:run-commands",
      "options": {
        "cwd": "examples/demo-app",
        "command": "pnpm exec playwright install chromium"
      },
      "dependsOn": ["deploy-contracts-erc4337"]
    },
    "e2e:setup": {
      "executor": "nx:run-commands",
      "options": {
        "cwd": "examples/demo-app",
        "commands": [
          "pnpm exec playwright install chromium",
          "echo 'ðŸ”„ Rebuilding demo-app with fresh contract addresses...'",
          "pnpm nuxt generate --envName local"
        ]
      },
      "dependsOn": ["deploy-contracts-erc4337", "auth-server:build:local"]
    },
    "e2e": {
      "executor": "nx:run-commands",
      "options": {
        "cwd": "examples/demo-app",
        "command": "playwright test --config=playwright.config.ts"
      },
      "dependsOn": ["e2e:setup"]
    },
    "e2e:erc4337": {
      "executor": "nx:run-commands",
      "options": {
        "cwd": "examples/demo-app",
        "command": "playwright test --config=playwright-erc4337.config.ts"
      },
      "dependsOn": ["e2e:setup:erc4337"]
    },
    "ci:erc4337": {
      "executor": "nx:run-commands",
      "options": {
        "cwd": "examples/demo-app",
        "command": "PW_TEST_HTML_REPORT_OPEN=never playwright test --config=playwright-erc4337.config.ts --reporter=list"
      },
      "dependsOn": ["e2e:setup:erc4337"]
    },
    "e2e:debug": {
      "executor": "nx:run-commands",
      "options": {
        "cwd": "examples/demo-app",
        "command": "playwright test --ui"
      },
      "dependsOn": ["e2e:setup"]
    },
    "show-report": {
      "executor": "nx:run-commands",
      "options": {
        "cwd": "examples/demo-app",
        "command": "playwright show-report"
      }
    }
  }
}
